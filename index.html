<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中达国通电梯更新</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🛗</text></svg>">
    <!-- 高德地图 API -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=your_amap_key"></script>
</head>
<body>
    <!-- 背景装饰 -->
    <div class="background-decoration">
        <div class="elevator-shaft shaft-1">
            <div class="elevator-car"></div>
        </div>
        <div class="elevator-shaft shaft-2">
            <div class="elevator-car"></div>
        </div>
        <div class="elevator-shaft shaft-3">
            <div class="elevator-car"></div>
        </div>
        <div class="building-silhouette"></div>
    </div>

    <div id="app">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-left">
                <div class="logo-container">
                    <svg class="logo-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="2" width="32" height="36" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <rect x="8" y="6" width="10" height="14" rx="1" stroke="currentColor" stroke-width="1.5" fill="rgba(255,255,255,0.2)"/>
                        <rect x="22" y="6" width="10" height="14" rx="1" stroke="currentColor" stroke-width="1.5" fill="rgba(255,255,255,0.2)"/>
                        <line x1="20" y1="6" x2="20" y2="20" stroke="currentColor" stroke-width="1"/>
                        <circle cx="20" cy="26" r="2" fill="currentColor"/>
                        <path d="M14 30 L20 34 L26 30" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    </svg>
                </div>
                <div class="header-title">
                    <h1>中达国通电梯更新</h1>
                    <span class="header-subtitle">住宅电梯更新改造管理系统</span>
                </div>
            </div>
            <div class="header-right">
                <div class="admin-status" id="adminStatus">
                    <span class="admin-icon">👤</span>
                    <span class="admin-text" id="adminText">访客模式</span>
                </div>
                <button class="btn-admin" id="btnAdminLogin" title="管理员登录">
                    🔐 登录
                </button>
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot online"></span>
                    <span class="status-text">在线模式</span>
                </div>
                <span class="date-display" id="currentDate"></span>
            </div>
        </header>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 侧边栏 - 项目列表 -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2>📋 项目列表</h2>
                    <button class="btn-add admin-only" id="btnAddProject" title="新建项目" style="display:none;">
                        <span>+</span>
                    </button>
                </div>
                <div class="project-search">
                    <input type="text" id="searchProject" placeholder="🔍 搜索项目...">
                </div>
                <div class="project-list" id="projectList">
                    <!-- 项目列表将动态生成 -->
                </div>
            </aside>

            <!-- 主工作区 -->
            <section class="workspace" id="workspace">
                <!-- 欢迎页面 -->
                <div class="welcome-page" id="welcomePage">
                    <div class="welcome-content">
                        <div class="welcome-icon-container">
                            <svg class="welcome-elevator-icon" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="10" y="5" width="100" height="110" rx="4" stroke="currentColor" stroke-width="3" fill="rgba(26,115,232,0.1)"/>
                                <rect x="20" y="15" width="35" height="50" rx="2" stroke="currentColor" stroke-width="2" fill="rgba(255,255,255,0.5)"/>
                                <rect x="65" y="15" width="35" height="50" rx="2" stroke="currentColor" stroke-width="2" fill="rgba(255,255,255,0.5)"/>
                                <line x1="60" y1="15" x2="60" y2="65" stroke="currentColor" stroke-width="2"/>
                                <circle cx="60" cy="80" r="6" fill="currentColor"/>
                                <path d="M40 95 L60 105 L80 95" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h2>欢迎使用中达国通电梯更新管理系统</h2>
                        <p class="welcome-desc">专业的住宅老旧电梯更新改造项目管理平台</p>
                        <div class="welcome-features">
                            <div class="feature-item">
                                <span class="feature-icon">📊</span>
                                <span>流程可视化</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">📷</span>
                                <span>照片云存储</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">📱</span>
                                <span>多端同步</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">🗺️</span>
                                <span>地图定位</span>
                            </div>
                        </div>
                        <button class="btn-primary btn-large admin-only" id="btnCreateFirst" style="display:none;">
                            <span>+</span> 创建新项目
                        </button>
                        <p class="visitor-hint" id="visitorHint">请登录管理员账号以创建和编辑项目</p>
                    </div>
                </div>

                <!-- 项目详情页面 -->
                <div class="project-detail" id="projectDetail" style="display: none;">
                    <div class="project-header">
                        <div class="project-info">
                            <div class="project-title-row">
                                <h2 id="projectTitle"></h2>
                                <span class="project-badge" id="projectBadge">进行中</span>
                            </div>
                            <div class="project-meta">
                                <span class="project-date" id="projectDate"></span>
                                <span class="project-address" id="projectAddress"></span>
                            </div>
                        </div>
                        <div class="project-actions admin-only" style="display:none;">
                            <button class="btn-icon" id="btnShowMap" title="查看地图">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                            </button>
                            <button class="btn-icon" id="btnEditProject" title="编辑项目">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon btn-danger" id="btnDeleteProject" title="删除项目">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- 地图容器 -->
                    <div class="map-container" id="mapContainer" style="display:none;">
                        <div class="map-header">
                            <h3>📍 项目位置</h3>
                            <button class="btn-secondary btn-sm" id="btnCloseMap">关闭地图</button>
                        </div>
                        <div id="mapView" style="width:100%; height:300px;"></div>
                    </div>

                    <!-- 进度概览 -->
                    <div class="progress-overview" id="progressOverview">
                        <div class="progress-bar-large">
                            <div class="progress-fill-large" id="progressFill"></div>
                        </div>
                        <div class="progress-stats">
                            <span id="progressText">0/8 步骤完成</span>
                            <span id="progressPercent">0%</span>
                        </div>
                    </div>

                    <!-- 流程步骤 -->
                    <div class="steps-container" id="stepsContainer">
                        <!-- 步骤将动态生成 -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 管理员登录模态框 -->
    <div class="modal" id="adminModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>🔐 管理员登录</h3>
                <button class="modal-close" id="closeAdminModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="admin-slots">
                    <p>请选择管理员并输入密码：</p>
                    <div class="form-group">
                        <label>管理员账号</label>
                        <select id="adminSelect">
                            <option value="admin1">管理员1</option>
                            <option value="admin2">管理员2</option>
                            <option value="admin3">管理员3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" id="adminPassword" placeholder="请输入管理员密码">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelAdminModal">取消</button>
                <button class="btn-primary" id="confirmAdminLogin">登录</button>
            </div>
        </div>
    </div>

    <!-- 新建/编辑项目模态框 -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">新建项目</h3>
                <button class="modal-close" id="closeProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="projectName">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        项目名称 <span class="required">*</span>
                    </label>
                    <input type="text" id="projectName" placeholder="请输入项目名称，如：XX小区1号楼电梯更新">
                </div>
                <div class="form-group">
                    <label for="projectAddress">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        项目地址
                    </label>
                    <input type="text" id="projectAddress" placeholder="请输入项目地址">
                </div>
                <div class="form-group">
                    <label for="projectCoords">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                        地图坐标（经度,纬度）
                    </label>
                    <input type="text" id="projectCoords" placeholder="例如：116.397428,39.90923">
                </div>
                <div class="form-group">
                    <label for="projectType">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="3" x2="9" y2="21"/>
                        </svg>
                        更新类型（补贴标准）
                    </label>
                    <select id="projectType">
                        <option value="type1">一类更新（补贴10万元/台）</option>
                        <option value="type2">二类更新（补贴15万元/台）</option>
                        <option value="type3">三类更新（补贴20万元/台）</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="elevatorCount">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        电梯数量
                    </label>
                    <input type="number" id="elevatorCount" placeholder="请输入电梯数量" min="1" value="1">
                </div>
                <div class="form-group">
                    <label for="projectNote">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <line x1="17" y1="10" x2="3" y2="10"/>
                            <line x1="21" y1="6" x2="3" y2="6"/>
                            <line x1="21" y1="14" x2="3" y2="14"/>
                            <line x1="17" y1="18" x2="3" y2="18"/>
                        </svg>
                        备注说明
                    </label>
                    <textarea id="projectNote" rows="3" placeholder="请输入备注说明"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelProjectModal">取消</button>
                <button class="btn-primary" id="saveProject">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    保存
                </button>
            </div>
        </div>
    </div>

    <!-- 照片查看模态框 -->
    <div class="modal" id="photoModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="photoModalTitle">查看照片</h3>
                <button class="modal-close" id="closePhotoModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="photo-gallery" id="photoGallery">
                    <!-- 照片将动态生成 -->
                </div>
                <div class="upload-area admin-only" id="uploadArea" style="display:none;">
                    <input type="file" id="photoInput" multiple accept="image/*" style="display: none;">
                    <div class="upload-placeholder" id="uploadPlaceholder">
                        <div class="upload-icon-container">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                        </div>
                        <p class="upload-text">点击或拖拽照片到此处上传</p>
                        <p class="upload-hint">支持 JPG、PNG、GIF 格式，单张最大 10MB</p>
                    </div>
                </div>
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="upload-progress-bar">
                        <div class="upload-progress-fill" id="uploadProgressFill"></div>
                    </div>
                    <span class="upload-progress-text" id="uploadProgressText">上传中...</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelPhotoModal">关闭</button>
                <button class="btn-primary admin-only" id="btnUploadPhoto" style="display:none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    上传照片
                </button>
            </div>
        </div>
    </div>

    <!-- 照片预览模态框 -->
    <div class="modal" id="previewModal">
        <div class="modal-content modal-preview">
            <button class="modal-close preview-close" id="closePreviewModal">&times;</button>
            <div class="preview-container">
                <button class="preview-nav prev" id="prevPhoto">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <img id="previewImage" src="" alt="预览图片">
                <button class="preview-nav next" id="nextPhoto">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                </button>
            </div>
            <div class="preview-info">
                <span id="previewInfo"></span>
                <button class="btn-danger btn-sm admin-only" id="deletePhoto" style="display:none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    删除此照片
                </button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div class="modal" id="confirmModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>确认操作</h3>
            </div>
            <div class="modal-body">
                <div class="confirm-icon">⚠️</div>
                <p id="confirmMessage">确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelConfirm">取消</button>
                <button class="btn-danger" id="confirmAction">确定删除</button>
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>加载中...</p>
        </div>
    </div>

    <!-- Toast 提示 -->
    <div class="toast" id="toast"></div>

    <script src="leancloud-config.js"></script>
    <script src="app.js"></script>
</body>
</html>
